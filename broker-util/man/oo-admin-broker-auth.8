.\" Text automatically generated by txt2man
.TH oo-admin-broker-auth 8 "06 March 2013" "" ""
.SH NAME
\fBoo-admin-broker-auth
\fB
.SH SYNOPSIS
.nf
.fam C
\fBoo-admin-broker-auth\fP [\fB-h\fP|\fB--help\fP] [\fB-t\fP|\fB--timeout\fP \fIinteger\fP] 
[\fB--find-gears\fP] [\fB--verbose\fP] [\fB--dryrun\fP] [\fB--rekey-all\fP] [\fB--rekey\fP \fIuuid\fP]

.fam T
.fi
.fam T
.fi
.SH DESCRIPTION
Utility to recreate the Broker authentication tokens for gears.
.SH OPTIONS
\fB-h\fP|\fB--help\fP
Display a simple help dialog.
.PP
\fB--rekey-all\fP
Rekey all gears in parallel.
.PP
\fB-r\fP|\fB--rekey\fP \fIuuid\fP
Rekey an individual gear.
.PP
\fB-t\fP|\fB--timeout\fP \fIinteger\fP
MCollective timeout for node discovery (default is 20 seconds).
.PP
\fB--find-gears\fP
Print out gears with using Broker key authentication.
.PP
\fB--dryrun\fP
Show what would be done. Useful for finding discrepancies in Nodes reported by the Broker datastore and the message bus.
.PP
\fB--verbose\fP
Show debugging information 
.SH EXAMPLE

.PP
.nf
.fam C
    $ oo-admin-broker-auth --rekey-all

.fam T
.fi
.TP
If you have tens of thousands of gears it will likely be best to run them in batch.
Running smaller jobs provides better output.
.PP
.nf
.fam C
    $ oo-admin-broker-auth --find-gears | split - gears_
    $ for f in $(ls gears_*); do cat $f | oo-admin-broker-auth; done

.fam T
.fi
.TP
The script will return 0 if there were no failures.  Otherwise the exit status will be the number of failures encountered.  Using the \fB--dryrun\fP flag is useful to see the error report without actually regenerating keys.
.SH WARNINGS

.TP
If rekeying more than a few dozen Gears it's highly recommended that either the \fB--rekey-all\fP flag be used or that the UUIDs be piped in on STDIN.  This is due to the fact that loading Rails is relatively expensive and when rekeys are issued in batches they are executed in parallel by the MCollective agents.

.TP
In the event the Broker datastore (mongo) and the Broker message bug are out of sync the script will appear to hang. This is due to the way MCollective timeouts work.  You can use \fB--dryrun\fP to see the errors and fix them before rekeying.
.SH SEE ALSO
\fBoo-admin-ctl-district\fP(8), \fBoo-setup-broker\fP(8), \fBoo-admin-move\fP(8),
\fBoo-admin-chk\fP(8), \fBoo-accept-broker\fP(8), \fBoo-admin-ctl-app\fP(8),
\fBoo-admin-ctl-domain\fP(8), \fBoo-setup-bind\fP(8),
\fBoo-admin-ctl-user\fP(8), \fBoo-register-dns\fP(8)
.SH AUTHOR
Brenton Leanhardt <bleanhar@redhat.com>
